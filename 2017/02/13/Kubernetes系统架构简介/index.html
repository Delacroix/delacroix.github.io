<!DOCTYPE html>
<html>
    <head>
    <!--
        © Material Theme 
        https://github.com/viosey/hexo-theme-material
        Version: 1.2.5
    -->
    
    <!-- Title -->
    
    <title>
        Kubernetes系统架构简介 | Delacroix&#39;s Blog
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Delacroix">
    <meta name="description" content="Ŭ����Ϊһ��CCIE">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Delacroix&#39;s Blog">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="https://delacroix.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Kubernetes系统架构简介 | Delacroix&#39;s Blog">
    <meta property="og:description" content="Ŭ����Ϊһ��CCIE">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-white.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#【转】Kubernetes系统架构简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">【转】Kubernetes系统架构简介</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-前言"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1. 前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-什么是Kubernetes"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2. 什么是Kubernetes</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-Kubernetes主要概念"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3. Kubernetes主要概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-Pods"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">3.1. Pods</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-Services"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">3.2. Services</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-3-Replication-Controllers"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">3.3. Replication Controllers</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-4-Labels"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">3.4. Labels</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-Kubernetes构件"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">4. Kubernetes构件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-1-Master"><span class="post-toc-number">1.3.6.</span> <span class="post-toc-text">4.1. Master</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-1-Minion-Registry"><span class="post-toc-number">1.3.6.1.</span> <span class="post-toc-text">3.1.1. Minion Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-2-Pod-Registry"><span class="post-toc-number">1.3.6.2.</span> <span class="post-toc-text">3.1.2. Pod Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-3-Service-Registry"><span class="post-toc-number">1.3.6.3.</span> <span class="post-toc-text">3.1.3. Service Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-4-Controller-Registry"><span class="post-toc-number">1.3.6.4.</span> <span class="post-toc-text">3.1.4. Controller Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-5-Endpoints-Registry"><span class="post-toc-number">1.3.6.5.</span> <span class="post-toc-text">3.1.5. Endpoints Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-6-Binding-Registry"><span class="post-toc-number">1.3.6.6.</span> <span class="post-toc-text">3.1.6. Binding Registry</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-7-Scheduler"><span class="post-toc-number">1.3.6.7.</span> <span class="post-toc-text">3.1.7. Scheduler</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-2-Kubelet"><span class="post-toc-number">1.3.7.</span> <span class="post-toc-text">4.2. Kubelet</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-3-Proxy"><span class="post-toc-number">1.3.8.</span> <span class="post-toc-text">4.3. Proxy</span></a></li></ol></li></ol></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 19 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            Kubernetes系统架构简介
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Delacroix</strong>
        <span>2月 13, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->

    <!-- Qrcode -->
    


    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Docker/">Docker</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Kubernetes/">Kubernetes</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/架构/">架构</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">

    

    

    <!-- Share Weibo -->
    
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Kubernetes系统架构简介&url=https://delacroix.github.io//2017/02/13/Kubernetes系统架构简介/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
    

    <!-- Share Twitter -->
    
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Kubernetes系统架构简介&url=https://delacroix.github.io//2017/02/13/Kubernetes系统架构简介/index.html&via=Delacroix" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    

    <!-- Share Facebook -->
    
    <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=https://delacroix.github.io//2017/02/13/Kubernetes系统架构简介/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Facebook
        </li>
    </a>
    

    <!-- Share Google+ -->
    
    <a class="post_share-link" href="https://plus.google.com/share?url=https://delacroix.github.io//2017/02/13/Kubernetes系统架构简介/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<h1 id="【转】Kubernetes系统架构简介"><a href="#【转】Kubernetes系统架构简介" class="headerlink" title="【转】Kubernetes系统架构简介"></a>【转】Kubernetes系统架构简介</h1><p>原文 <a href="http://www.infoq.com/cn/articles/Kubernetes-system-architecture-introduction" target="_blank" rel="external">http://www.infoq.com/cn/articles/Kubernetes-system-architecture-introduction</a></p>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><blockquote>
<p>Together we will ensure that Kubernetes is a strong and open container management framework for any application and in any environment, whether in a private, public or hybrid cloud.</p>
<p>Urs Hölzle, Google</p>
</blockquote>
<p>Kubernetes作为Docker生态圈中重要一员，是Google多年大规模容器管理技术的开源版本，是产线实践经验的最佳表现[G1] 。如Urs Hölzle所说，无论是公有云还是私有云甚至混合云，Kubernetes将作为一个为任何应用，任何环境的容器管理框架无处不在。正因为如此， 目前受到各大巨头及初创公司的青睐，如Microsoft、VMWare、Red Hat、CoreOS、Mesos等，纷纷加入给Kubernetes贡献代码。随着Kubernetes社区及各大厂商的不断改进、发展，Kuberentes将成为容器管理领域的领导者。</p>
<p>接下来我们会用一系列文章逐一探索Kubernetes是什么、能做什么以及怎么做。</p>
<h2 id="2-什么是Kubernetes"><a href="#2-什么是Kubernetes" class="headerlink" title="2. 什么是Kubernetes"></a>2. 什么是Kubernetes</h2><p>Kubernetes是Google开源的容器集群管理系统，其提供应用部署、维护、 扩展机制等功能，利用Kubernetes能方便地管理跨机器运行容器化的应用，其主要功能如下：</p>
<p>1) 使用Docker对应用程序包装(package)、实例化(instantiate)、运行(run)。</p>
<p>2) 以集群的方式运行、管理跨机器的容器。</p>
<p>3) 解决Docker<strong>跨机器容器之间的通讯</strong>问题。</p>
<p>4) Kubernetes的<strong>自我修复机制</strong>使得容器集群总是运行在用户期望的状态。</p>
<p>当前Kubernetes支持GCE、vShpere、CoreOS、OpenShift、Azure等平台，除此之外，也可以直接运行在物理机上。</p>
<p>接下来本文主要从以下几方面阐述Kubernetes：</p>
<p>1) Kubernetes的主要概念。</p>
<p>2) Kubernetes的构件，包括Master组件、Kubelet、Proxy的详细介绍。</p>
<h2 id="3-Kubernetes主要概念"><a href="#3-Kubernetes主要概念" class="headerlink" title="3. Kubernetes主要概念"></a>3. Kubernetes主要概念</h2><h3 id="3-1-Pods"><a href="#3-1-Pods" class="headerlink" title="3.1. Pods"></a>3.1. Pods</h3><p>Pod是Kubernetes的基本操作单元，把相关的一个或多个容器构成一个Pod，通常Pod里的容器<strong>运行相同的应用</strong>。Pod包含的容器<strong>运行在同一个Minion(Host)上</strong>，看作一个统一管理单元，<strong>共享</strong>相同的volumes和network namespace/IP和Port<strong>空间</strong>。</p>
<h3 id="3-2-Services"><a href="#3-2-Services" class="headerlink" title="3.2. Services"></a>3.2. Services</h3><p>Services也是Kubernetes的基本操作单元，是真实应用服务的抽象，每一个服务后面都有很多对应的容器来支持，通过Proxy的port和服务selector决定服务请求传递给后端提供服务的容器，<strong>对外表现为一个单一访问接口</strong>，外部不需要了解后端如何运行，这给扩展或维护后端带来很大的好处。</p>
<h3 id="3-3-Replication-Controllers"><a href="#3-3-Replication-Controllers" class="headerlink" title="3.3. Replication Controllers"></a>3.3. Replication Controllers</h3><p>Replication Controller确保<strong>任何时候Kubernetes集群中有指定数量的pod副本(replicas)在运行</strong>， 如果少于指定数量的pod副本(replicas)，Replication Controller会启动新的Container，反之会杀死多余的以保证数量不变。Replication Controller使用预先定义的pod模板创建pods，一旦创建成功，pod 模板和创建的pods没有任何关联，可以修改pod 模板而不会对已创建pods有任何影响，也可以直接更新通过Replication Controller创建的pods。对于利用pod 模板创建的pods，Replication Controller根据label selector来关联，通过修改pods的label可以删除对应的pods。Replication Controller主要有如下用法：</p>
<p>1) Rescheduling</p>
<p>如上所述，Replication Controller会<strong>确保Kubernetes集群中指定的pod副本(replicas)在运行</strong>， 即使在节点出错时。</p>
<p>2) Scaling</p>
<p>通过修改Replication Controller的副本(replicas)数量来<strong>水平扩展</strong>或者缩小运行的pods。</p>
<p>3) Rolling updates</p>
<p>Replication Controller的设计原则使得可以<strong>一个一个地替换pods</strong>来rolling updates服务。</p>
<p>4) Multiple release tracks</p>
<p>如果需要在系统中运行multiple release的服务，Replication Controller<strong>使用labels来区分</strong>multiple release tracks。</p>
<h3 id="3-4-Labels"><a href="#3-4-Labels" class="headerlink" title="3.4. Labels"></a>3.4. Labels</h3><p>Labels是用于区分Pod、Service、Replication Controller的<strong>key/value键值对</strong>，Pod、Service、 Replication Controller可以有多个label，但是每个label的key只能对应一个value。Labels是Service和Replication Controller运行的基础，为了将访问Service的请求转发给后端提供服务的多个容器，正是通过标识容器的labels来选择正确的容器。同样，<strong>Replication Controller也使用labels来管理通过pod 模板创建的一组容器</strong>，这样Replication Controller可以更加容易，方便地管理多个容器，无论有多少容器。</p>
<h3 id="4-Kubernetes构件"><a href="#4-Kubernetes构件" class="headerlink" title="4. Kubernetes构件"></a>4. Kubernetes构件</h3><p>Kubenetes整体框架如下图3-1，主要包括kubecfg、Master API Server、Kubelet、Minion(Host)以及Proxy。<br><img src="/images/k8s_arch/1.jpg" alt="Alt text"><br>图3-1 Kubernetes High Level构件</p>
<h3 id="4-1-Master"><a href="#4-1-Master" class="headerlink" title="4.1. Master"></a>4.1. Master</h3><p>Master定义了Kubernetes 集群Master/API Server的主要声明，包括Pod Registry、Controller Registry、Service Registry、Endpoint Registry、Minion Registry、Binding Registry、RESTStorage以及Client, 是client(Kubecfg)调用Kubernetes API，管理Kubernetes主要构件Pods、Services、Minions、容器的入口。<strong>Master由API Server、Scheduler以及Registry等组成</strong>。从下图3-2可知Master的工作流主要分以下步骤：</p>
<p>1) Kubecfg将特定的请求，比如创建Pod，发送给Kubernetes Client。</p>
<p>2) Kubernetes Client将请求发送给API server。</p>
<p>3) API Server根据请求的类型，比如创建Pod时storage类型是pods，然后依此选择何种REST Storage API对请求作出处理。</p>
<p>4) REST Storage API对的请求作相应的处理。</p>
<p>5) 将处理的结果存入高可用键值存储系统Etcd中。</p>
<p>6) 在API Server响应Kubecfg的请求后，Scheduler会根据Kubernetes Client获取集群中运行Pod及Minion信息。</p>
<p>7) 依据从Kubernetes Client获取的信息，Scheduler将未分发的Pod分发到可用的Minion节点上。</p>
<p>下面是Master的主要构件的详细介绍：<br><img src="/images/k8s_arch/2.jpg" alt="Alt text"><br>图3-2 Master主要构件及工作流</p>
<h4 id="3-1-1-Minion-Registry"><a href="#3-1-1-Minion-Registry" class="headerlink" title="3.1.1. Minion Registry"></a>3.1.1. Minion Registry</h4><p><strong>Minion Registry负责跟踪Kubernetes 集群中有多少Minion(Host)</strong>。Kubernetes封装Minion Registry成实现Kubernetes API Server的RESTful API接口REST，通过这些API，我们可以对Minion Registry做Create、Get、List、Delete操作，由于Minon只能被创建或删除，所以不支持Update操作，并把Minion的相关配置信息存储到etcd。除此之外，<strong>Scheduler算法根据Minion的资源容量来确定是否将新建Pod分发到该Minion节点。</strong></p>
<h4 id="3-1-2-Pod-Registry"><a href="#3-1-2-Pod-Registry" class="headerlink" title="3.1.2. Pod Registry"></a>3.1.2. Pod Registry</h4><p>Pod Registry负责跟踪Kubernetes<strong>集群中有多少Pod在运行</strong>，以及<strong>这些Pod跟Minion是如何的映射关系</strong>。将Pod Registry和Cloud Provider信息及其他相关信息封装成实现Kubernetes API Server的RESTful API接口REST。通过这些API，我们可以对Pod进行Create、Get、List、Update、Delete操作，并将Pod的信息存储到etcd中，而且可以<strong>通过Watch接口监视Pod的变化情况，比如一个Pod被新建、删除或者更新</strong>。</p>
<h4 id="3-1-3-Service-Registry"><a href="#3-1-3-Service-Registry" class="headerlink" title="3.1.3. Service Registry"></a>3.1.3. Service Registry</h4><p>Service Registry负责跟踪Kubernetes<strong>集群中运行的所有服务</strong>。根据提供的Cloud Provider及Minion Registry信息把Service Registry封装成实现Kubernetes API Server需要的RESTful API接口REST。利用这些接口，我们可以对Service进行Create、Get、List、Update、Delete操作，以及监视Service变化情况的watch操作，并把Service信息存储到etcd。</p>
<h4 id="3-1-4-Controller-Registry"><a href="#3-1-4-Controller-Registry" class="headerlink" title="3.1.4. Controller Registry"></a>3.1.4. Controller Registry</h4><p>Controller Registry负责跟踪Kubernetes<strong>集群中所有的Replication Controller</strong>，Replication Controller<strong>维护着指定数量的pod 副本(replicas)拷贝</strong>，如果其中的一个容器死掉，Replication Controller会自动启动一个新的容器，如果死掉的容器恢复，其会杀死多出的容器以保证指定的拷贝不变。通过封装Controller Registry为实现Kubernetes API Server的RESTful API接口REST， 利用这些接口，我们可以对Replication Controller进行Create、Get、List、Update、Delete操作，以及监视Replication Controller变化情况的watch操作，并把Replication Controller信息存储到etcd。</p>
<h4 id="3-1-5-Endpoints-Registry"><a href="#3-1-5-Endpoints-Registry" class="headerlink" title="3.1.5. Endpoints Registry"></a>3.1.5. Endpoints Registry</h4><p>Endpoints Registry负责收集<strong>Service的endpoint(注：服务暴露的接口)</strong>，比如Name：”mysql”，Endpoints: [“10.10.1.1:1909”，”10.10.2.2:8834”]，同Pod Registry，Controller Registry也实现了Kubernetes API Server的RESTful API接口，可以做Create、Get、List、Update、Delete以及watch操作。</p>
<h4 id="3-1-6-Binding-Registry"><a href="#3-1-6-Binding-Registry" class="headerlink" title="3.1.6. Binding Registry"></a>3.1.6. Binding Registry</h4><p>Binding包括一个<strong>需要绑定Pod的ID和Pod被绑定的Host</strong>，Scheduler写Binding Registry后，需绑定的Pod被绑定到一个host。Binding Registry也实现了Kubernetes API Server的RESTful API接口，但Binding Registry是一个write-only对象，所有只有Create操作可以使用， 否则会引起错误。</p>
<h4 id="3-1-7-Scheduler"><a href="#3-1-7-Scheduler" class="headerlink" title="3.1.7. Scheduler"></a>3.1.7. Scheduler</h4><p>Scheduler收集和分析当前Kubernetes<strong>集群中所有Minion节点的资源(内存、CPU)负载情况</strong>，然后依此分发新建的Pod到Kubernetes集群中可用的节点。由于一旦Minion节点的资源被分配给Pod，那这些资源就不能再分配给其他Pod， 除非这些Pod被删除或者退出， 因此，Kubernetes需要分析集群中所有Minion的资源使用情况，保证分发的工作负载不会超出当前该Minion节点的可用资源范围。具体来说，Scheduler做以下工作：</p>
<p>1) 实时监测Kubernetes集群中<strong>未分发的Pod</strong>。</p>
<p>2) 实时监测Kubernetes<strong>集群中所有运行的Pod</strong>，Scheduler需要根据这些Pod的资源状况安全地将未分发的Pod分发到指定的Minion节点上。</p>
<p>3) Scheduler也<strong>监测Minion节点信息</strong>，由于会频繁查找Minion节点，Scheduler会缓存一份最新的信息在本地。</p>
<p>4) 最后，Scheduler在分发Pod到指定的Minion节点后，会<strong>把Pod相关的信息Binding写回API Server</strong>。</p>
<h3 id="4-2-Kubelet"><a href="#4-2-Kubelet" class="headerlink" title="4.2. Kubelet"></a>4.2. Kubelet</h3><p><img src="/images/k8s_arch/3.jpg" alt="Alt text"><br>图3-3 Kubernetes详细构件</p>
<p>根据上图3-3可知Kubelet是Kubernetes集群中每个<strong>Minion和Master API Server的连接点</strong>，Kubelet运行在每个Minion上，是Master API Server和Minion之间的桥梁，接收Master API Server分配给它的commands和work，与持久性键值存储etcd、file、server和http进行交互，读取配置信息。Kubelet的主要工作是<strong>管理Pod和容器的生命周期</strong>，其包括Docker Client、Root Directory、Pod Workers、Etcd Client、Cadvisor Client以及Health Checker组件，具体工作如下：</p>
<p>1) 通过Worker给Pod异步运行特定的Action。</p>
<p>2) 设置容器的环境变量。</p>
<p>3) 给容器绑定Volume。</p>
<p>4) 给容器绑定Port。</p>
<p>5) 根据指定的Pod运行一个单一容器。</p>
<p>6) 杀死容器。</p>
<p>7) 给指定的Pod创建network 容器。</p>
<p>8) 删除Pod的所有容器。</p>
<p>9) 同步Pod的状态。</p>
<p>10) 从Cadvisor获取container info、 pod info、root info、machine info。</p>
<p>11) 检测Pod的容器健康状态信息。</p>
<p>12) 在容器中运行命令。</p>
<h3 id="4-3-Proxy"><a href="#4-3-Proxy" class="headerlink" title="4.3. Proxy"></a>4.3. Proxy</h3><p>Proxy是为了<strong>解决外部网络能够访问跨机器集群中容器提供的应用服务</strong>而设计的，从上图3-3可知Proxy服务也运行在每个Minion上。<strong>Proxy提供TCP/UDP sockets的proxy</strong>，每创建一种Service，Proxy主要从etcd获取Services和Endpoints的配置信息，或者也可以从file获取，然后根据配置信息在Minion上启动一个Proxy的进程并监听相应的服务端口，当外部请求发生时，Proxy会根据Load Balancer<strong>将请求分发到后端正确的容器处理</strong>。</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    


                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/02/09/mysqldump-error-1066-not-unique-table/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Delacroix's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        unmask429@gmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="#" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->


    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">5</span></a>
        </ul>
    </li>

    <!-- Categories  -->
    

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">11</span>
        </a>
    </li>
</ul>


		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/twitter" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    

    <!-- Facebook -->
    
    <a href="https://www.facebook.com/facebook" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    

    <!-- Google + -->
    
    <a href="https://www.google.com/" target="_blank"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    

    <!-- Weibo -->
    
    

    <!-- Instagram -->
    
    

    <!-- Tumblr -->
    
    

    <!-- Github -->
    
    

    <!-- LinkedIn -->
    
    

    <!-- Zhihu -->
    
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;Delacroix's Blog</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>











<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
